<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
      integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:400,600|Open+Sans:400,600,700"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/easion.css" />
  </head>

  <body>
    <div class="dash">
      <div class="dash-nav dash-nav-dark">
        <header>
          <a href="#!" class="menu-toggle">
            <i class="fas fa-bars"></i>
          </a>
          <a href="index.html" class="easion-logo"><span>Library</span></a>
        </header>
        <nav class="dash-nav-list">
          <a href="index.html" class="dash-nav-item">
            <i class="fas fa-home"></i> Dashboard
          </a>
          <a href="book.html" class="dash-nav-item">
            <i class="fas fa-book"></i> Manage Books
          </a>
          <a href="category.html" class="dash-nav-item">
            <i class="fas fa-list"></i> Manage Categories
          </a>
        </nav>
      </div>
      <div class="dash-app">
        <header class="dash-toolbar">
          <a href="#!" class="menu-toggle">
            <i class="fas fa-bars"></i>
          </a>
          <div class="tools">
            <div class="dropdown tools-item">
              <a
                href="#"
                class=""
                id="dropdownMenu1"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-user"></i>
              </a>
              <div
                class="dropdown-menu dropdown-menu-right"
                aria-labelledby="dropdownMenu1"
              >
                <a class="dropdown-item" href="profile.html">Profile</a>
                <a class="dropdown-item" href="#!" id="logout-btn">Logout</a>
              </div>
            </div>
          </div>
        </header>
        <main class="dash-content">
          <div class="container-fluid">
            <h1 class="dash-title">Books Overview</h1>
            <div class="row">
              <div class="col-lg-12">
                <div class="card easion-card">
                  <div class="card-header">
                    <div class="easion-card-icon">
                      <i class="fas fa-table"></i>
                    </div>
                    <div class="easion-card-title">All Books</div>
                  </div>
                  <div class="card-body">
                    <table class="table table-striped table-in-card">
                      <thead>
                        <tr>
                          <th scope="col">#</th>
                          <th scope="col">Name</th>
                          <th scope="col">Description</th>
                          <th scope="col">Category</th>
                          <th scope="col">Quantity</th>
                        </tr>
                      </thead>
                      <tbody id="books-table-body">
                        <tr>
                          <td colspan="5" class="text-center">
                            Loading books...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script src="../js/easion.js"></script>
    <script src="../js/auth.js"></script>

    <script>
      // Check authentication
      window.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "login.html";
          return;
        }
        loadBooks();
      });

      // Load all books (view only)
      async function loadBooks() {
        try {
          const response = await bookAPI.getAll();
          const tbody = document.getElementById("books-table-body");

          if (!response.success || response.books.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="5" class="text-center">No books found. <a href="book.html">Add books here</a>.</td></tr>';
            return;
          }

          tbody.innerHTML = response.books
            .map(
              (book, index) => `
                    <tr>
                        <th scope="row">${index + 1}</th>
                        <td>${book.name}</td>
                        <td>${book.description || "-"}</td>
                        <td>
                            ${
                              book.categoryId
                                ? `
                                <span class="badge" style="background-color: ${book.categoryId.color || "#6c757d"}; color: white; padding: 5px 10px; border-radius: 3px;">
                                    ${book.categoryId.name}
                                </span>
                            `
                                : "-"
                            }
                        </td>
                        <td>${book.quantity}</td>
                    </tr>
                `,
            )
            .join("");
        } catch (error) {
          console.error("Error loading books:", error);
          document.getElementById("books-table-body").innerHTML =
            `<tr><td colspan="5" class="text-center text-danger">Error loading books: ${error.message}</td></tr>`;
        }
      }

      // Logout functionality
      document.getElementById("logout-btn").addEventListener("click", logout);
    </script>
  </body>
</html>
